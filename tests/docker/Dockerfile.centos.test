# SYSMAINT CentOS Stream Test Environment
# SPDX-License-Identifier: MIT
# Copyright (c) 2025 Harery

ARG BASE_IMAGE=quay.io/centos/centos:stream9
FROM ${BASE_IMAGE}

LABEL maintainer="Harery <mohamed@harery.com>"
LABEL description="SYSMAINT CentOS Stream Test Environment"
LABEL version="1.0"

ENV TZ=UTC

RUN dnf install -y epel-release && \
    dnf install -y \
    sudo \
    bash \
    jq \
    ShellCheck \
    curl \
    dialog \
    bc \
    time \
    coreutils \
    procps-ng \
    systemd \
    && dnf clean all

RUN useradd -m -s /bin/bash testuser && \
    echo "testuser ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

RUN mkdir -p /tmp/system-maintenance /var/log/system-maintenance

WORKDIR /sysmaint

COPY sysmaint /usr/local/sbin/sysmaint
RUN chmod +x /usr/local/sbin/sysmaint

COPY tests/ /sysmaint/tests/
COPY lib/ /sysmaint/lib/
RUN chmod +x /sysmaint/tests/*.sh

USER testuser

CMD ["/bin/bash"]
