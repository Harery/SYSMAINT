# SYSMAINT Test Docker Compose
# SPDX-License-Identifier: MIT
# Copyright (c) 2025 Harery
#
# Orchestrate test containers for multiple OS distributions
#
# Usage:
#   docker-compose -f tests/docker/docker-compose.test.yml build
#   docker-compose -f tests/docker/docker-compose.test.yml up
#   docker-compose -f tests/docker/docker-compose.test.yml up ubuntu-24
#   docker-compose -f tests/docker/docker-compose.test.yml down

version: '3.8'

services:
  # Ubuntu 22.04 (Jammy)
  ubuntu-22:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.ubuntu.test
      args:
        BASE_IMAGE: ubuntu:22.04
    image: sysmaint-test:ubuntu-22.04
    container_name: sysmaint-test-ubuntu-22
    hostname: ubuntu-22-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=ubuntu
      - OS_VERSION=22.04

  # Ubuntu 24.04 (Noble)
  ubuntu-24:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.ubuntu.test
      args:
        BASE_IMAGE: ubuntu:24.04
    image: sysmaint-test:ubuntu-24.04
    container_name: sysmaint-test-ubuntu-24
    hostname: ubuntu-24-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=ubuntu
      - OS_VERSION=24.04

  # Debian 12 (Bookworm)
  debian-12:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.debian.test
      args:
        BASE_IMAGE: debian:12
    image: sysmaint-test:debian-12
    container_name: sysmaint-test-debian-12
    hostname: debian-12-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=debian
      - OS_VERSION=12

  # Debian 13 (Trixie)
  debian-13:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.debian.test
      args:
        BASE_IMAGE=debian:13
    image: sysmaint-test:debian-13
    container_name: sysmaint-test-debian-13
    hostname: debian-13-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=debian
      - OS_VERSION=13

  # Fedora 41
  fedora-41:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.fedora.test
      args:
        BASE_IMAGE=fedora:41
    image: sysmaint-test:fedora-41
    container_name: sysmaint-test-fedora-41
    hostname: fedora-41-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=fedora
      - OS_VERSION=41

  # RHEL 9 (using UBI)
  rhel-9:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.rhel.test
      args:
        BASE_IMAGE: registry.access.redhat.com/ubi9
        UBI_INIT: registry.access.redhat.com/ubi9-init
    image: sysmaint-test:rhel-9
    container_name: sysmaint-test-rhel-9
    hostname: rhel-9-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=rhel
      - OS_VERSION=9

  # RHEL 10 (using UBI)
  rhel-10:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.rhel.test
      args:
        BASE_IMAGE: registry.access.redhat.com/ubi10
        UBI_INIT: registry.access.redhat.com/ubi10-init
    image: sysmaint-test:rhel-10
    container_name: sysmaint-test-rhel-10
    hostname: rhel-10-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=rhel
      - OS_VERSION=10

  # Rocky Linux 9
  rocky-9:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.rocky.test
      args:
        BASE_IMAGE=rockylinux:9
    image: sysmaint-test:rocky-9
    container_name: sysmaint-test-rocky-9
    hostname: rocky-9-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=rocky
      - OS_VERSION=9

  # Rocky Linux 10
  rocky-10:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.rocky.test
      args:
        BASE_IMAGE=rockylinux:10
    image: sysmaint-test:rocky-10
    container_name: sysmaint-test-rocky-10
    hostname: rocky-10-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=rocky
      - OS_VERSION=10

  # AlmaLinux 9
  almalinux-9:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.almalinux.test
      args:
        BASE_IMAGE=almalinux:9
    image: sysmaint-test:almalinux-9
    container_name: sysmaint-test-almalinux-9
    hostname: almalinux-9-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=almalinux
      - OS_VERSION=9

  # CentOS Stream 9
  centos-9:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.centos.test
      args:
        BASE_IMAGE=quay.io/centos/centos:stream9
    image: sysmaint-test:centos-9
    container_name: sysmaint-test-centos-9
    hostname: centos-9-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=centos
      - OS_VERSION=9

  # Arch Linux
  arch:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.arch.test
      args:
        BASE_IMAGE=archlinux:base
    image: sysmaint-test:arch
    container_name: sysmaint-test-arch
    hostname: arch-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=arch
      - OS_VERSION=rolling

  # openSUSE Tumbleweed
  opensuse:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.opensuse.test
      args:
        BASE_IMAGE=opensuse/tumbleweed
    image: sysmaint-test:opensuse
    container_name: sysmaint-test-opensuse
    hostname: opensuse-test
    privileged: true
    volumes:
      - ../../sysmaint:/usr/local/sbin/sysmaint:ro
      - ../../tests:/sysmaint/tests:ro
      - ../../lib:/sysmaint/lib:ro
    environment:
      - TEST_PROFILE=smoke
      - OS_NAME=opensuse
      - OS_VERSION=tumbleweed
