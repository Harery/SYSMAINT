version: "3.8"

services:
  # SYSMAINT - One-time execution
  sysmaint:
    image: ghcr.io/harery/sysmaint:latest
    container_name: sysmaint
    privileged: true
    restart: "no"  # Run once and exit
    volumes:
      # Mount host root filesystem (read-only for safety)
      - /:/host:ro
    environment:
      - SYSMAINT_LOG_LEVEL=info
      - SYSMAINT_VERSION=1.0.0
    networks:
      - maintenance
    labels:
      - "com.sysmaint.description=Enterprise Linux System Maintenance"
      - "com.sysmaint.version=1.0.0"

  # SYSMAINT - Scheduled (for daemon mode)
  # Uncomment to use as a persistent service
  # sysmaint-scheduled:
  #   image: ghcr.io/harery/sysmaint:latest
  #   container_name: sysmaint-scheduled
  #   privileged: true
  #   restart: unless-stopped
  #   volumes:
  #     - /:/host:ro
  #     - ./logs:/var/log/sysmaint
  #     - ./config:/etc/sysmaint:ro
  #   environment:
  #     - SYSMAINT_LOG_LEVEL=info
  #     - TZ=UTC
  #   networks:
  #     - maintenance

  # SYSMAINT - with PostgreSQL (example integration)
  # Uncomment this section if you want to integrate with database maintenance
  # sysmaint-with-db:
  #   image: ghcr.io/harery/sysmaint:latest
  #   container_name: sysmaint-with-db
  #   privileged: true
  #   restart: "no"
  #   depends_on:
  #     - postgres
  #   volumes:
  #     - /:/host:ro
  #   environment:
  #     - DB_HOST=postgres
  #     - DB_PORT=5432
  #     - DB_NAME=maintenance_db
  #   networks:
  #     - maintenance
  # postgres:
  #   image: postgres:16-alpine
  #   container_name: postgres-maintenance
  #   restart: always
  #   environment:
  #     - POSTGRES_DB=maintenance_db
  #     - POSTGRES_USER=sysmaint
  #     - POSTGRES_PASSWORD=changeme
  #   volumes:
  #     - postgres-data:/var/lib/postgresql/data
  #   networks:
  #     - maintenance

networks:
  maintenance:
    driver: bridge
    labels:
      - "com.sysmaint.network=Maintenance Network"

# Uncomment for persistent database storage
# volumes:
#   postgres-data:
#     driver: local
