name: Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: Test on Ubuntu
    runs-on: ubuntu-latest

    strategy:
      matrix:
        distribution:
          - ubuntu:22.04
          - ubuntu:24.04

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker
        uses: docker/setup-buildx-action@v3

      - name: Run tests in container
        run: |
          docker build -t sysmaint-test -f Dockerfile .
          docker run --rm sysmaint-test /bin/bash -c "chmod +x sysmaint && ./sysmaint --dry-run"

  validate:
    name: Validate Documentation
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check required files exist
        run: |
          for file in README.md CONTRIBUTING.md SECURITY.md SUPPORT.md LICENSE; do
            if [ ! -f "$file" ]; then
              echo "Missing required file: $file"
              exit 1
            fi
          done
          echo "All required files present"
